<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas of Erasure | A Record of the Nakba</title>
    <meta name="description" content="An interactive map documenting the over 500 Palestinian villages and towns ethnically cleansed and destroyed by Zionist militias and the Israeli state during the 1948 Nakba.">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/styles/atlas.css">
    <link rel="stylesheet" href="/vendor/leaflet/leaflet.css">
    <link rel="stylesheet" href="/vendor/leaflet/MarkerCluster.css">
    <link rel="stylesheet" href="/vendor/leaflet/MarkerCluster.Default.css">
    <link rel="stylesheet" href="/codex-modal-host.css">
    <script defer src="/codex-modal-host.iife.js" onload="window.dispatchEvent(new Event('codex:host:ready'))"></script>
</head>
<body class="bg-bg-color text-text-primary overflow-hidden">

    <div id="map-loading-status" class="sr-only" aria-live="polite" aria-atomic="true">Preparing the atlas…</div>
    <div id="map-atlas"></div>

    <div id="map-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- Main Information & Filter Panel -->
    <div class="absolute top-0 left-0 p-4 md:p-6 max-w-sm w-full z-[1000] pointer-events-none">

        <button id="info-box-toggle" aria-expanded="true" aria-controls="info-box-content" class="info-toggle mb-2 p-2 rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-colors pointer-events-auto">
            <span class="sr-only">Toggle info panel</span>
            <svg class="icon-close h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            <svg class="icon-open h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
        </button>

        <div id="info-box-content" class="info-panel p-6 rounded-lg pointer-events-auto">
            <h1 class="font-serif text-3xl md:text-4xl text-white leading-tight">The Atlas of Erasure</h1>
            <p class="mt-2 text-gray-400">
                This map is a visual record of the Nakba—the systematic ethnic cleansing of over 500 Palestinian villages and cities by Zionist militias in 1948. Each point is a wound on the land and a testament to a life that was stolen. Click a marker to bear witness.
            </p>
            <a href="/" class="resource-link mt-4 inline-block">← Return to the Unfolding Map</a>
            
            <!-- NEW: Search & Filter Section -->
            <div id="filter-container" class="mt-6 border-t border-gray-700 pt-4 space-y-4">
                
                <!-- Search Box -->
                <div>
                    <label for="search-box" class="font-serif text-xl text-white">Search Village</label>
                    <div id="search-combobox" class="search-combobox" role="combobox" aria-haspopup="listbox" aria-expanded="false">
                        <input
                            type="text"
                            id="search-box"
                            placeholder="e.g., Deir Yassin"
                            class="w-full mt-2 p-2 rounded bg-gray-900/50 border border-gray-600 text-white focus:ring-2 focus:ring-accent-color focus:border-accent-color"
                            aria-autocomplete="list"
                            aria-controls="search-results"
                            aria-describedby="search-helper"
                            autocomplete="off"
                        >
                        <ul id="search-results" class="search-results" role="listbox" aria-hidden="true"></ul>
                    </div>
                    <p id="search-helper" class="text-sm text-gray-400 mt-2">Start typing to see matching villages. Use the arrow keys to move through the results.</p>
                </div>

                <!-- Filter Accordions -->
                <div class="space-y-2">
                    <!-- District Filter -->
                    <div class="accordion-item">
                        <button class="filter-accordion-trigger w-full flex justify-between items-center py-2" aria-expanded="false" aria-controls="district-filters-panel">
                            <span class="font-serif text-xl text-white">District</span>
                            <svg class="accordion-icon w-5 h-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="district-filters-panel" class="filter-accordion-panel pl-2">
                            <div id="district-filters" class="space-y-1"></div>
                        </div>
                    </div>

                    <!-- Military Operation Filter -->
                    <div class="accordion-item">
                        <button class="filter-accordion-trigger w-full flex justify-between items-center py-2" aria-expanded="false" aria-controls="operation-filters-panel">
                            <span class="font-serif text-xl text-white">Military Operation</span>
                            <svg class="accordion-icon w-5 h-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="operation-filters-panel" class="filter-accordion-panel pl-2">
                            <div id="operation-filters" class="space-y-1"></div>
                        </div>
                    </div>

                    <!-- Destroying Force Filter -->
                    <div class="accordion-item">
                        <button class="filter-accordion-trigger w-full flex justify-between items-center py-2" aria-expanded="false" aria-controls="destroyed-by-filters-panel">
                            <span class="font-serif text-xl text-white">Destroying Force</span>
                            <svg class="accordion-icon w-5 h-5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="destroyed-by-filters-panel" class="filter-accordion-panel pl-2">
                            <div id="destroyed-by-filters" class="space-y-1"></div>
                        </div>
                    </div>
                </div>

                <!-- Reset Button -->
                <button id="reset-filters-btn" class="w-full mt-4 py-2 px-4 bg-red-800/50 text-white font-semibold rounded-lg hover:bg-red-700/70 transition-colors">Clear All Filters</button>

            </div>
        </div>
    </div>

    <script type="module" src="./atlas-loader.js"></script>

</body>
</html>
